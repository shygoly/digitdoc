下面给出一套在 **Windows** 上落地、可稳定运行 **wsplayer** 的端侧技术架构方案（含医生端大屏），并映射到你提出的8项目标。关键点：统一走 **Electron (Chromium)** 壳 + 原有服务接口；视频与语音/对话统一通过 `websocket`/`WebRTC`；`wsplayer` 负责 H.264 播放（RTSP→WebSocket）。涉及到的系统与接口字段，均来自你现有文档。

---

# 一、总体方案（Windows）

**形态**：Electron 单体应用（患者端 / 医生端两套壳，代码同仓不同配置）

* **OS**：Windows 10/11（x64/ARM64 都可）
* **Runtime**：Node.js LTS + Chromium（随 Electron）
* **UI 框架**：React（或 Vue）+ Tailwind（可选）
* **流媒体播放**：内置 `wsplayer`（H.264/ACC，WebSocket 通道）
* **语音链路**：麦克风采集（WASAPI）→ WebRTC 或 WebSocket 上行到后端 ASR；ASR 文本经 WebSocket 回传
* **数字人视频**：后端已将「大模型→TTS→口型」合成的视频按帧率推到 Web 端播放器（wsplayer）
* **对话/病历/体测**：REST + Socket.io 事件（case1~6、triage、user/assistant_content、face_detect）
* **人脸登录**：前端通过 WebRTC 采集图像，后端做人脸识别并通过 WebSocket 返回姓名/ID

> 你现有系统把 2D 数字人、大模型、ASR、视频监控、数据库等都已经服务化；前端只需按接口集成即可。

---

# 二、模块划分

```
Electron Shell (Windows)
├─ Main Process
│  ├─ 自启动/单实例/崩溃恢复
│  ├─ Kiosk 模式（大屏）/ 普通模式（家用）
│  └─ 自动更新（electron-updater / Squirrel / MSIX）
├─ Renderer (React)
│  ├─ StreamingPlayer：wsplayer 封装（RTSP→WS）
│  ├─ VoiceAgent：麦克风采集 & 上行（WebRTC/WS）
│  ├─ FaceLogin：摄像头采集 & WebRTC 握手
│  ├─ DialogueUI：问诊/咨询（文本+语音）
│  ├─ ScreeningUI：量表筛查（语音/触控、可跳题）
│  ├─ EMRUpload：病历拍照/上传与OCR回显
│  ├─ FamilyProfiles：家庭多用户档案与切换
│  ├─ HealthData：体测图表（血压/血糖/体温等）
│  ├─ ScheduleMemo：日程/记忆查看与语音修改
│  └─ TVDoctorView：医生端（大屏展示版）
└─ Services (Renderer/Preload)
   ├─ SocketService：socket.io 事件（case1~6、triage 等）
   ├─ RestService：REST 封装（GetDialogData/GetAllDoctors/QueryHealthData/GetAllUsers）
   ├─ DeviceService：音视频设备枚举、WASAPI、摄像头选择
   └─ SettingsStore：本地配置/会话缓存/家庭成员切换
```

**与后端对接要点（按你现有接口）**

* **对话内容**：ASR 文本经 WebSocket 投送到页面
* **数字人合成**：大模型输出→TTS→口型→视频，推流到前端播放器
* **视频监控**：NVR→RTSP→WebSocket，前端同样用 wsplayer 播放
* **病历六要素**：前端触发 `case1` 自动生成到 `case6`（socket.io），并监听 `case_content1~6` 回传
* **分诊**：触发 `triage`，监听 `send_triage`
* **人脸结果**：监听 `face_detect` 广播
* **体测数据**：`/ExtExportAPI/QueryHealthData` 查询不同表（如 `glutable`、`nibptable`、`temptable` 等）
* **医生列表**：`/ExtExportAPI/GetAllDoctors`（含头像 Base64）

---

# 三、播放与采集链路（wsplayer 核心）

1. **数字人/监控视频播放**

* **后端**：H.264 编码 → 以 RTSP+WebSocket 方式投送到前端播放器（wsplayer）
* **前端**：在 Electron 的 Renderer 中使用内置 **wsplayer**（你已提供 zip）；启用 **GPU 硬解**（Chromium 默认支持），确保大屏 1080p/2K 无卡顿。

2. **语音问诊链路**

* 采集麦克风 → ASR 子系统（WebRTC 或 WS）→ 文本通过 WebSocket 回传（`user_content`/`assistant_content` 事件）
* 文本与气泡 UI 同步渲染；当数字人开口时禁用“开始说话”按钮（与现有患者端交互一致）。

3. **人脸登录**

* 前端摄像头视频通过 WebRTC 发送；后端做人脸识别并通过 WebSocket 返回认证姓名/ID，前端展示。

---

# 四、部署与运维（Windows）

* **打包**：Electron Builder → `MSI` / `MSIX`；医生端与患者端通过不同 `APP_ID` / 不同配置打两个包。
* **自启动**：注册任务计划或放入启动文件夹；医生端支持 **Kiosk 模式**（全屏禁鼠标/键盘退出，或仅保留管理员热键）。
* **证书与“非安全源”**：

  * 优先用 **HTTPS/WSS**（自签或机构证书）；
  * 如需临时开发联调，可像文档所述将服务地址加入 **Chrome/Chromium 白名单** `chrome://flags/#unsafely-treat-insecure-origin-as-secure`（Electron 也可设置对应 flags）。
* **GPU 解码**：Electron 默认启用；必要时通过 `app.commandLine.appendSwitch('ignore-gpu-blacklist')` 强制打开硬件加速。
* **日志**：前端 `electron-log`，后端接口失败与 socket 断线自动重连并上报。
* **更新**：`electron-updater` 对接私有更新源；医生端大屏可设“静默更新+重启窗口”。

---

# 五、满足 8 项目标的落地映射

1. **数字人医生为主界面、少触控闭环**

   * 首页即数字人+语音唤醒；流程节点（筛查/检测/上传/分诊）都用语音驱动，仅在必要处给触控兜底。
2. **多用户登录与信息管理**

   * FaceLogin + FamilyProfiles：同设备多档案，支持游客模式与人脸识别登录。
3. **对话进行咨询与问诊**

   * VoiceAgent + DialogueUI；后端 ASR 与大模型贯通，socket.io 负责内容流转与分诊结果。
4. **摄像头+少量交互录入报告**

   * EMRUpload：拍照/上传，后台解析指标并入库；前端展示结构化摘要与原图。
5. **结合病史给建议**

   * 调用 `GetDialogData`（回放对话）、`GetAllUsers`（既往史/家族史/个人史等字段）、`QueryHealthData`（体测）综合生成建议。
6. **量表筛查（糖尿病/阿兹海默等，可提前结束）**

   * ScreeningUI：后端驱动数字人逐题播报；异常/不会自动跳过，未答项由护理复核，完结显示评分与建议。
7. **大电视展示医生端系统**

   * 医生端 Electron in **Kiosk**；也可在 Windows 上使用 Edge WebView2 Kiosk 模式直开医生端 URL。
8. **医生端操作前端可见**

   * 双向 socket.io 通道：医生端动作 → 患者端 UI 状态变化（如高亮关注、推送 triage、同步病历要素）。

---

# 六、两种落地形态（可并行）

**A. Electron 独立客户端（首选）**

* 优点：统一控制浏览器内核、硬件加速、Kiosk、更新与日志。
* 适用：家庭设备、养老院一体机、医院科室大屏。

**B. 纯浏览器形态（Edge/Chrome）**

* 在 Windows 设置 **自启动** 打开指定 URL；医生端用 Edge Kiosk。
* 需配置“非安全源白名单”（开发/内网），或正确签发 HTTPS/WSS 证书。

---

# 七、关键页面与接口绑定（示例）

* **首页/数字人**：

  * 播放器：`wsplayer(src=ws://…/video)`
  * 语音：`socket.emit('chat_start')` / `chat_end` → 监听 `user_content` / `assistant_content`
* **量表筛查**：

  * 由后端驱动逐题播报（文本+语音），失败/不知道自动跳过，结束展示评分
* **病历要素**：

  * 触发 `case1`（自动串联 `case2..6`），监听 `case_content1..6`
* **分诊**：

  * `socket.emit('triage')` → 监听 `send_triage`
* **体测图表**：

  * `POST /ExtExportAPI/QueryHealthData`（表名：ecgtable/glutable/nibptable/temptable/spo2table…）

---

# 八、开发清单（最小可用）

* [ ] Electron 基座（单实例、自启动、Kiosk、更新）
* [ ] 集成 **wsplayer**（你提供的 zip）与解码性能验证
* [ ] WebRTC/WS 语音上行与 ASR 回传绑定
* [ ] Socket.io 事件收发（case1~6、triage、user/assistant/face_detect）
* [ ] REST SDK（四个核心 API）
* [ ] 家庭档案/人脸登录/游客模式
* [ ] 量表筛查 UI（语音+触控、异常跳过、护理复核）
* [ ] 病历拍照/上传组件
* [ ] 体测数据图表（时间范围筛选）
* [ ] 医生端大屏视图（Kiosk）

---

需要的话，我可以基于这个方案给你一份 **Electron + React 的最小骨架代码**（含 wsplayer 容器组件与 socket/REST 封装），直接在 Windows 上跑通对接你现有的三个端口地址与接口。
也可以把“医生端（Kiosk）”与“患者端（普通窗体）”打成两份安装包配置。
